---
title: "Predicting customer lifetime value"
subtitle: ""
excerpt: "using tidymodels to predict customer lifetime value and identify churned customers"
date: 2022-11-27
author: "Alex Labuda"
draft: true
thumbnail_left: true # for list-sidebar only
show_author_byline: true
images: 
series:
tags: ["machine learning", "data wrangling"]
categories:
layout: single
---


# Customer Lifetime Value 

CLV with Machine Learning using RFM Features 

In this blog we will wrangle customer spend and behaviour data to engineer recency, frequency and monetary value features as input to our model which will predict the probability of a customer spending, as well as how much they are predicted to spend.

This can help marketers identify and target customers they are highly likely to spend, as well customers that are highly likely to spend even more.


```r
library(tidymodels)
```

```
## ── Attaching packages ────────────────────────────────────── tidymodels 1.0.0 ──
```

```
## ✔ broom        1.0.1          ✔ recipes      1.0.1     
## ✔ dials        1.0.0.9000     ✔ rsample      1.1.0     
## ✔ dplyr        1.0.10         ✔ tibble       3.1.8     
## ✔ ggplot2      3.3.6          ✔ tidyr        1.2.1     
## ✔ infer        1.0.3          ✔ tune         1.0.0     
## ✔ modeldata    1.0.1          ✔ workflows    1.1.0     
## ✔ parsnip      1.0.2          ✔ workflowsets 1.0.0     
## ✔ purrr        0.3.4          ✔ yardstick    1.1.0
```

```
## ── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
## ✖ purrr::discard() masks scales::discard()
## ✖ dplyr::filter()  masks stats::filter()
## ✖ dplyr::lag()     masks stats::lag()
## ✖ recipes::step()  masks stats::step()
## • Use suppressPackageStartupMessages() to eliminate package startup messages
```

```r
library(vip)
```

```
## 
## Attaching package: 'vip'
```

```
## The following object is masked from 'package:utils':
## 
##     vi
```

```r
library(tidyverse)
```

```
## ── Attaching packages
## ───────────────────────────────────────
## tidyverse 1.3.2 ──
```

```
## ✔ readr   2.1.3     ✔ forcats 0.5.2
## ✔ stringr 1.4.1     
## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ readr::col_factor() masks scales::col_factor()
## ✖ purrr::discard()    masks scales::discard()
## ✖ dplyr::filter()     masks stats::filter()
## ✖ stringr::fixed()    masks recipes::fixed()
## ✖ dplyr::lag()        masks stats::lag()
## ✖ readr::spec()       masks yardstick::spec()
```

```r
library(timetk)
library(lubridate)
```

```
## 
## Attaching package: 'lubridate'
## 
## The following objects are masked from 'package:base':
## 
##     date, intersect, setdiff, union
```

```r
library(gt)
```


# Data Prep ----

```
## Rows: 75374 Columns: 13
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: ","
## chr (12): date, customer_id, product_name1, product_name2, product_name3, pr...
## dbl  (1): order_total
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
```



|date      |customer_id | order_total|product_name1                                                         |product_name2                   |product_name3 |product_name4 |product_name5 |product_category1    |product_category2    |product_category3 |product_category4 |product_category5 |
|:---------|:-----------|-----------:|:---------------------------------------------------------------------|:-------------------------------|:-------------|:-------------|:-------------|:--------------------|:--------------------|:-----------------|:-----------------|:-----------------|
|1/26/2022 |N241027     |       42.00|CPR/AED Smart Certification App                                       |NA                              |NA            |NA            |NA            |Continuing Education |NA                   |NA                |NA                |NA                |
|1/26/2022 |N1290714    |      495.73|Personal Trainer Basic Study Program                                  |CPR/AED Smart Certification App |NA            |NA            |NA            |Publications         |Continuing Education |NA                |NA                |NA                |
|1/26/2022 |N1290986    |      491.00|Group Fitness Instructor Advantage Program                            |CPR/AED Smart Certification App |NA            |NA            |NA            |Publications         |Continuing Education |NA                |NA                |NA                |
|1/26/2022 |N1290942    |      119.96|The Professional's Guide to Health and Wellness Coaching - eBook only |NA                              |NA            |NA            |NA            |Publications         |NA                   |NA                |NA                |NA                |
|1/26/2022 |N885586     |      524.37|Personal Trainer Plus Study Program                                   |NA                              |NA            |NA            |NA            |Publications         |NA                   |NA                |NA                |NA                |










































































